name: Discord Notifications


on:
  push:
    branches: [ "main" ]
  pull_request:
    types: [opened, synchronize, closed]
  workflow_dispatch:

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:

      # --- PUSH ‚Üí commit √ºzenettel ---
      - name: Discord (PUSH)
        if: ${{ github.event_name == 'push' }}
        uses: Ilshidur/action-discord@master
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
        with:
          args: |
            üîÑ **Push**
            ‚Ä¢ Repo: **${{ github.repository }}**
            ‚Ä¢ Branch: **${{ github.ref_name }}**
            ‚Ä¢ By: **${{ github.actor }}**
            ‚Ä¢ Commit: `${{ github.sha }}`
            ‚Ä¢ Message:
            ```text
            ${{ github.event.head_commit.message }}
            ```
            üîó https://github.com/${{ github.repository }}/commit/${{ github.sha }}

      # --- PR OPENED / UPDATE (synchronize) ---
      - name: Discord (PR opened/updated)
        if: ${{ github.event_name == 'pull_request' && github.event.action != 'closed' }}
        uses: Ilshidur/action-discord@master
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
        with:
          args: |
            üß© **Pull Request**
            ‚Ä¢ Repo: **${{ github.repository }}**
            ‚Ä¢ PR: **#${{ github.event.pull_request.number }} ‚Äì ${{ github.event.pull_request.title }}**
            ‚Ä¢ Author: **${{ github.event.pull_request.user.login }}**
            ‚Ä¢ Base ‚ñ∏ Head: **${{ github.base_ref || github.event.pull_request.base.ref }} ‚ñ∏ ${{ github.head_ref || github.event.pull_request.head.ref }}**
            ‚Ä¢ State: **${{ github.event.action }}**
            üîó PR link: ${{ github.event.pull_request.html_url }}

      # --- PR MERGED ---
      - name: Discord (PR merged)
        if: ${{ github.event_name == 'pull_request' && github.event.action == 'closed' && github.event.pull_request.merged == true }}
        uses: Ilshidur/action-discord@master
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
        with:
          args: |
            ‚úÖ **PR merged**
            ‚Ä¢ Repo: **${{ github.repository }}**
            ‚Ä¢ PR: **#${{ github.event.pull_request.number }} ‚Äì ${{ github.event.pull_request.title }}**
            ‚Ä¢ Merged by: **${{ github.actor }}**
            üîó ${{ github.event.pull_request.html_url }}

      # --- PR CLOSED (not merged) ---
      - name: Discord (PR closed - not merged)
        if: ${{ github.event_name == 'pull_request' && github.event.action == 'closed' && github.event.pull_request.merged != true }}
        uses: Ilshidur/action-discord@master
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
        with:
          args: |
            üõë **PR closed (not merged)**
            ‚Ä¢ Repo: **${{ github.repository }}**
            ‚Ä¢ PR: **#${{ github.event.pull_request.number }} ‚Äì ${{ github.event.pull_request.title }}**
            ‚Ä¢ Closed by: **${{ github.actor }}**
            üîó ${{ github.event.pull_request.html_url }}

      # --- K√âZI IND√çT√ÅS (workflow_dispatch) ---
      - name: Discord (manual dispatch)
        if: ${{ github.event_name == 'workflow_dispatch' }}
        uses: Ilshidur/action-discord@master
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
        with:
          args: |
            ‚ñ∂Ô∏è **Manual dispatch**
            ‚Ä¢ Repo: **${{ github.repository }}**
            ‚Ä¢ By: **${{ github.actor }}**
            üîó Actions run: https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}
