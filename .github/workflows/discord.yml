name: Discord Notifications

on:
  push:
    branches: [ "main" ]
  pull_request:
    types: [opened, reopened, synchronize, closed]
  workflow_dispatch: {}  # k√©zi ind√≠t√°s gomb az Actions f√ºl√∂n

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      # -------- PUSH --------
      - name: Discord (push)
        if: ${{ github.event_name == 'push' }}
        uses: Ilshidur/action-discord@master
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
        with:
          args: |
            üì¢ **Hickory Update ‚Äì PUSH**
            ‚Ä¢ Repo: **${{ github.repository }}**
            ‚Ä¢ Branch: **${{ github.ref_name }}**
            ‚Ä¢ Author: **${{ github.actor }}**
            ‚Ä¢ Commit: `${{ github.sha }}`
            üîó Commit link: https://github.com/${{ github.repository }}/commit/${{ github.sha }}
            üîó Run log: https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}

      # --- PR OPEN/UPDATE (nem z√°rt) ---
      - name: Discord (PR opened/reopened/synchronize)
        if: ${{ github.event_name == 'pull_request' && github.event.action != 'closed' }}
        uses: Ilshidur/action-discord@master
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
        with:
          args: |
            üîÄ **Pull Request**
            ‚Ä¢ Repo: **${{ github.repository }}**
            ‚Ä¢ PR: **#${{ github.event.pull_request.number }} ‚Äì ${{ github.event.pull_request.title }}**
            ‚Ä¢ Author: **${{ github.actor }}**
            ‚Ä¢ Base ‚Üí Head: **${{ github.base_ref }} ‚Üê ${{ github.head_ref }}**
            ‚Ä¢ State: **${{ github.event.action }}**
            üîó PR link: ${{ github.event.pull_request.html_url }}

      # --- PR MERGED ---
      - name: Discord (PR merged)
        if: ${{ github.event_name == 'pull_request' && github.event.action == 'closed' && github.event.pull_request.merged == true }}
        uses: Ilshidur/action-discord@master
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
        with:
          args: |
            ‚úÖ **PR merged**
            ‚Ä¢ Repo: **${{ github.repository }}**
            ‚Ä¢ PR: **#${{ github.event.pull_request.number }} ‚Äì ${{ github.event.pull_request.title }}**
            ‚Ä¢ Merged by: **${{ github.actor }}**
            üîó PR link: ${{ github.event.pull_request.html_url }}

      # --- PR CLOSED (NEM MERGED) ---
      - name: Discord (PR closed without merge)
        if: ${{ github.event_name == 'pull_request' && github.event.action == 'closed' && github.event.pull_request.merged != true }}
        uses: Ilshidur/action-discord@master
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
        with:
          args: |
            üö´ **PR closed (not merged)**
            ‚Ä¢ Repo: **${{ github.repository }}**
            ‚Ä¢ PR: **#${{ github.event.pull_request.number }} ‚Äì ${{ github.event.pull_request.title }}**
            ‚Ä¢ Closed by: **${{ github.actor }}**
            üîó PR link: ${{ github.event.pull_request.html_url }}
